import{ssr as l,ssrHydrationKey as y,escape as f,isServer as M,getRequestEvent as k,createComponent as c,ssrElement as R,mergeProps as N,useAssets as j,NoHydration as x,HydrationScript as F,ssrAttribute as O,Hydration as B,renderToStream as W}from"solid-js/web";import{createSignal as U,onCleanup as D,ErrorBoundary as z,lazy as G,createComponent as J,sharedConfig as E}from"solid-js";import{provideRequestEvent as K}from"solid-js/web/storage";import{H3Event as S,setResponseStatus as V,sendRedirect as Y,getCookie as Q,setCookie as X,setHeader as Z,getRequestURL as ee,getRequestIP as te,getResponseStatus as ne,getResponseStatusText as re,getResponseHeaders as se,getResponseHeader as oe,setResponseHeader as ae,appendResponseHeader as ie,getRequestWebStream as ce,removeResponseHeader as ue,eventHandler as le}from"h3";import{getContext as pe}from"unctx";import{AsyncLocalStorage as de}from"node:async_hooks";import{createRouter as he}from"radix3";var fe=["<main",'><h1>Hello world!</h1><button id="test-inc" class="increment">Clicks: <span id="test-value">','</span></button><p>Visit <a href="https://start.solidjs.com" target="_blank">start.solidjs.com</a> to learn how to build SolidStart apps.</p></main>'];function me(){const[e,t]=U(0);return l(fe,y(),f(e()))}function ge(e){if(M){const t=k();t.response.status=e.code,t.response.statusText=e.text,D(()=>!t.nativeEvent.handled&&(t.response.status=200))}return null}function ye(e){return c(z,{get fallback(){return c(ge,{code:500})},get children(){return e.children}})}var Re=" ";const $e={style:e=>R("style",e.attrs,()=>f(e.children),!0),link:e=>R("link",e.attrs,void 0,!0),script:e=>e.attrs.src?R("script",N(()=>e.attrs,{get id(){return e.key}}),()=>l(Re),!0):null};function b(e){let{tag:t,attrs:{key:n,...r}={key:void 0},children:s}=e;return $e[t]({attrs:r,key:n,children:s})}var Se=["<script",">","<\/script>"],be=["<script",' type="module" async',"><\/script>"];const ve=l("<!DOCTYPE html>");function P(e,t,n=[]){for(let r=0;r<t.length;r++){const s=t[r];if(s.path!==e[0].path)continue;let o=[...n,s];if(s.children){const a=e.slice(1);if(a.length===0||(o=P(a,s.children,o),!o))continue}return o}}function Te(e){const t=k();let n=[];return Promise.resolve().then(async()=>{if(t.router&&t.router.matches){const r=[...t.router.matches];for(;r.length&&(!r[0].info||!r[0].info.filesystem);)r.shift();const s=r.length&&P(r,t.routes);if(s)for(let o=0;o<s.length;o++){const a=s[o],m=await globalThis.MANIFEST.client.inputs[a.$component.src].assets();n.push.apply(n,m)}else console.warn("No route matched for preloading js assets")}n=[...new Map(n.map(r=>[r.attrs.key,r])).values()].filter(r=>r.attrs.rel==="modulepreload"&&!t.assets.find(s=>s.attrs.key===r.attrs.key))}),j(()=>n.length?n.map(r=>b(r)):void 0),c(x,{get children(){return[ve,c(e.document,{get assets(){return[c(F,{}),t.assets.map(r=>b(r))]},get scripts(){return[l(Se,y(),`window.manifest = ${JSON.stringify(t.manifest)}`),l(be,y(),O("src",f(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return c(B,{get children(){return c(ye,{get children(){return c(me,{})}})}})}})]}})}function we(e){let t;const n=_(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(n,{...r,body:e.node.req.body}):new Request(n,{...r,get body(){return t||(t=Me(e),t)}})}function Ee(e){return e.web??={request:we(e),url:_(e)},e.web.request}function Ae(){return Fe()}const T=Symbol("$HTTPEvent");function Ce(e){return typeof e=="object"&&(e instanceof S||e?.[T]instanceof S||e?.__is_event__===!0)}function i(e){return function(...t){let n=t[0];if(Ce(n))t[0]=n instanceof S||n.__is_event__?n:n[T];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(n=Ae(),!n)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(n)}return e(...t)}}const _=i(ee),He=i(te),v=i(V),A=i(ne),qe=i(re),g=i(se),C=i(oe),ke=i(ae),xe=i(ie),Pe=i(Y),_e=i(Q),Ie=i(X),Le=i(Z),Me=i(ce),Ne=i(ue);function je(){return pe("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:de})}function Fe(){return je().use().event}const I=[],Oe=Be(I.filter(e=>e.$component));function Be(e){function t(n,r,s,o){const a=Object.values(n).find(u=>s.startsWith(u.id+"/"));return a?(t(a.children||(a.children=[]),r,s.slice(a.id.length)),n):(n.push({...r,id:s,path:s.replace(/\/\([^)/]+\)/g,"")}),n)}return e.sort((n,r)=>n.path.length-r.path.length).reduce((n,r)=>t(n,r,r.path,r.path),[])}function We(e,t){const n=De.lookup(e);if(n){const r=n.route[`$${t}`];return r===void 0?void 0:{handler:r,params:n.params}}}function Ue(e){return e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}const De=he({routes:I.reduce((e,t)=>{if(!Ue(t))return e;let n=t.path.replace(/\(.*\)\/?/g,"").replace(/\*([^/]*)/g,(r,s)=>`**:${s}`);if(/:[^/]*\?/g.test(n))throw new Error(`Optional parameters are not supported in API routes: ${n}`);if(e[n])throw new Error(`Duplicate API routes for "${n}" found at "${e[n].route.path}" and "${t.path}"`);return e[n]={route:t},e},{})}),$=Symbol("fetchEvent");function ze(e){return{request:Ee(e),response:Ke(e),clientAddress:He(e),locals:{},nativeEvent:e,[T]:e}}function Ge(e){if(!e[$]){const t=ze(e);e[$]=t}return e[$]}class Je{constructor(t){this.event=t}get(t){const n=C(this.event,t);return Array.isArray(n)?n.join(", "):n}has(t){return this.get(t)!==void 0}set(t,n){return ke(this.event,t,n)}delete(t){return Ne(this.event,t)}append(t,n){xe(this.event,t,n)}getSetCookie(){const t=C(this.event,"Set-Cookie");return Array.isArray(t)?t:[t]}forEach(t){return Object.entries(g(this.event)).forEach(([n,r])=>t(Array.isArray(r)?r.join(", "):r,n,this))}entries(){return Object.entries(g(this.event)).map(([t,n])=>[t,Array.isArray(n)?n.join(", "):n])[Symbol.iterator]()}keys(){return Object.keys(g(this.event))[Symbol.iterator]()}values(){return Object.values(g(this.event)).map(t=>Array.isArray(t)?t.join(", "):t)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function Ke(e){return{get status(){return A(e)},set status(t){v(e,t)},get statusText(){return qe(e)},set statusText(t){v(e,A(),t)},headers:new Je(e)}}function Ve(e){e.forEach(t=>{if(!t.attrs.href)return;let n=document.head.querySelector(`link[href="${t.attrs.href}"]`);n||(n=document.createElement("link"),n.setAttribute("rel","preload"),n.setAttribute("as","style"),n.setAttribute("href",t.attrs.href),document.head.appendChild(n))})}function Ye(e,t,n,r="default"){return G(async()=>{{const o=(await e.import())[r],u=(await t.inputs?.[e.src].assets()).filter(p=>p.tag==="style"||p.attrs.rel==="stylesheet");return typeof window<"u"&&Ve(u),{default:p=>[...u.map(d=>b(d)),J(o,p)]}}})}function Qe(){function e(n){return{...n,...n.$$route?n.$$route.require().route:void 0,info:{...n.$$route?n.$$route.require().route.info:{},filesystem:!0},component:Ye(n.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:n.children?n.children.map(e):void 0}}return Oe.map(e)}function Xe(e){const t=_e(e,"flash");if(!t)return;let n=JSON.parse(t);if(!n||!n.result)return[];const r=[...n.input.slice(0,-1),new Map(n.input[n.input.length-1])];return Ie(e,"flash","",{maxAge:0}),{url:n.url,result:n.error?new Error(n.result):n.result,input:r}}async function L(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],router:{submission:Xe(e)},routes:Qe(),$islands:new Set})}function Ze(e,t={}){return le({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:n=>{const r=Ge(n);return K(r,async()=>{const s=We(new URL(r.request.url).pathname,r.request.method);if(s){const h=(await s.handler.import())[r.request.method];r.params=s.params,E.context={event:r};const w=await h(r);if(w!==void 0)return w;if(r.request.method!=="GET")throw new Error(`API handler for ${r.request.method} "${r.request.url}" did not return a response.`)}const o=await L(r);let a={...t};if(a.onCompleteAll){const d=a.onCompleteAll;a.onCompleteAll=h=>{q(o)(h),d(h)}}else a.onCompleteAll=q(o);if(a.onCompleteShell){const d=a.onCompleteShell;a.onCompleteShell=h=>{H(o,n)(),d(h)}}else a.onCompleteShell=H(o,n);const u=W(()=>(E.context.event=o,e(o)),a);if(o.response&&o.response.headers.get("Location"))return Pe(r,o.response.headers.get("Location"));const{writable:m,readable:p}=new TransformStream;return u.pipeTo(m),p})}})}function H(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(v(t,302),Le(t,"Location",e.response.headers.get("Location")))}}function q(e){return({write:t})=>{const n=e.response&&e.response.headers.get("Location");n&&t(`<script>window.location="${n}"<\/script>`)}}function et(e,t={}){return Ze(e,{...t,createPageEvent:L})}var tt=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],nt=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const lt=et(()=>c(Te,{document:({assets:e,children:t,scripts:n})=>l(nt,y(),c(x,{get children(){return l(tt,f(e))}}),f(t),f(n))}));export{lt as default};
